////**********************************************************************************************************************************
//// FILE: main.c
///  Authors: Ashish Datta <adatta4@asu.edu> , Shane Nelson <stnelso1@asu.edu>
////**********************************************************************************************************************************
#include <stdio.h> // For printf()
#include "i2c.h" // For enumerated type i2c_mod
#include "oct_nunchuk.h"
#include "pit.h"
#include "int.h"
#include "dtim.h"
////==================================================================================================================================
//// Private Preprocessor Macros
////==================================================================================================================================
#define forever while (1)
////==================================================================================================================================
//// Static Function Definitions
////==================================================================================================================================
static void hw_init();
static void console_update();
static void sw_init();
////==================================================================================================================================
//// Private Global Variables
////==================================================================================================================================
static volatile int g_console_update;
////==================================================================================================================================
//// Function Definitions
////==================================================================================================================================
////----------------------------------------------------------------------------------------------------------------------------------
//// FUNCTION: g_console_update()
////
//// DESCRIPTION
//// Called by PIT 0 ISR at 1 Hz to update the console with the Wii Nunchuk state information.
////----------------------------------------------------------------------------------------------------------------------------------
__declspec(interrupt) static void console_update()
{
     
     printf("%d %d %d %d %d %d %d\n",
     oct_nunchuk_pos_x(),
     oct_nunchuk_pos_y(),
     oct_nunchuk_accel_x(),
     oct_nunchuk_accel_y(),
     oct_nunchuk_accel_z(),
     oct_nunchuk_button_c(),
     oct_nunchuk_button_z()
     );     
     pit_clear(0); 

}
////----------------------------------------------------------------------------------------------------------------------------------
//// FUNCTION: hw_init()
////
//// DESCRIPTION
//// Initializes the MCF52259 hardware peripherals.
////----------------------------------------------------------------------------------------------------------------------------------
static void hw_init()
{
 int_inhibit_all();
 dtim_init(0);
 oct_nunchuk_init(i2c_mod_1);
 //pit_init(pit_timer_0, pit_freq_1_hz, console_update);
 pit_init(0, 11, 19531, &console_update);
 int_uninhibit_all();
 pit_enable(0);
 pit_enable(1);
}
////----------------------------------------------------------------------------------------------------------------------------------
//// FUNCTION: main()
////----------------------------------------------------------------------------------------------------------------------------------
int main()
{
 hw_init();

// printf("%d %d %d %d %d %d %d\n",
// oct_nunchuk_pos_x(),
// oct_nunchuk_pos_y(),
// oct_nunchuk_accel_x(),
// oct_nunchuk_accel_y(),
// oct_nunchuk_accel_z(),
// oct_nunchuk_button_c(),
// oct_nunchuk_button_z()
// );
// g_console_update = 0;
// pit_clear(0);
}

////----------------------------------------------------------------------------------------------------------------------------------
//// FUNCTION: sw_init()
////
//// DESCRIPTION
//// Software initialization.
////----------------------------------------------------------------------------------------------------------------------------------
static void sw_init()
{
 g_console_update = 1;
}